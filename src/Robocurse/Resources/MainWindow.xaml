<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Robocurse - Replication Cursed Robo"
        Height="630" Width="900"
        MinHeight="630" MinWidth="900"
        WindowStartupLocation="CenterScreen"
        Background="#1E1E1E">

    <!-- ==================== RESOURCES: Theme Styles ==================== -->
    <Window.Resources>
        <!-- Dark Theme Styles -->
        <Style x:Key="DarkLabel" TargetType="Label">
            <Setter Property="Foreground" Value="#E0E0E0"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
        </Style>

        <Style x:Key="DarkTextBox" TargetType="TextBox">
            <Setter Property="Background" Value="#2D2D2D"/>
            <Setter Property="Foreground" Value="#E0E0E0"/>
            <Setter Property="BorderBrush" Value="#3E3E3E"/>
            <Setter Property="Padding" Value="5"/>
            <Setter Property="CaretBrush" Value="#E0E0E0"/>
        </Style>

        <Style x:Key="DarkButton" TargetType="Button">
            <Setter Property="Background" Value="#0078D4"/>
            <Setter Property="Foreground" Value="#1E1E1E"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="3"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#1084D8"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="#4A4A4A"/>
                    <Setter Property="Foreground" Value="#707070"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Soft Green Run button style (Apple-inspired) -->
        <Style x:Key="RunButton" TargetType="Button" BasedOn="{StaticResource DarkButton}">
            <Setter Property="Background" Value="#34C759"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#4CD964"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="#3D5A45"/>
                    <Setter Property="Foreground" Value="#6A8A72"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Soft Red Stop button style (Apple-inspired) -->
        <Style x:Key="StopButton" TargetType="Button" BasedOn="{StaticResource DarkButton}">
            <Setter Property="Background" Value="#FF6B6B"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FF8787"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="#703030"/>
                    <Setter Property="Foreground" Value="#995050"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Soft Purple Schedule button style (Apple-inspired) -->
        <Style x:Key="ScheduleButton" TargetType="Button" BasedOn="{StaticResource DarkButton}">
            <Setter Property="Background" Value="#AF52DE"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#BF6AE8"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="#4A3A5A"/>
                    <Setter Property="Foreground" Value="#7A6A8A"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Soft Amber Logs button style (Apple-inspired) -->
        <Style x:Key="LogsButton" TargetType="Button" BasedOn="{StaticResource DarkButton}">
            <Setter Property="Background" Value="#FFB340"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FFC266"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="#5A4A30"/>
                    <Setter Property="Foreground" Value="#8A7A5A"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Teal Validate button style -->
        <Style x:Key="ValidateButton" TargetType="Button" BasedOn="{StaticResource DarkButton}">
            <Setter Property="Background" Value="#17A2B8"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#1FC8E3"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="#2A4A50"/>
                    <Setter Property="Foreground" Value="#5A7A80"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="DarkCheckBox" TargetType="CheckBox">
            <Setter Property="Foreground" Value="#E0E0E0"/>
        </Style>

        <!-- Dark ScrollBar Thumb -->
        <Style x:Key="DarkScrollBarThumb" TargetType="Thumb">
            <Setter Property="OverridesDefaultStyle" Value="True"/>
            <Setter Property="IsTabStop" Value="False"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Thumb">
                        <Border Background="#505050" CornerRadius="4" Margin="2"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="Thumb">
                                <Border Background="#686868" CornerRadius="4" Margin="2"/>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Dark Vertical ScrollBar -->
        <Style x:Key="DarkScrollBar" TargetType="ScrollBar">
            <Setter Property="Background" Value="#2D2D2D"/>
            <Setter Property="Width" Value="12"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollBar">
                        <Border Background="#2D2D2D" CornerRadius="6">
                            <Track x:Name="PART_Track" IsDirectionReversed="True">
                                <Track.Thumb>
                                    <Thumb Style="{StaticResource DarkScrollBarThumb}"/>
                                </Track.Thumb>
                            </Track>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="Orientation" Value="Horizontal">
                    <Setter Property="Width" Value="Auto"/>
                    <Setter Property="Height" Value="12"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="ScrollBar">
                                <Border Background="#2D2D2D" CornerRadius="6">
                                    <Track x:Name="PART_Track" IsDirectionReversed="False">
                                        <Track.Thumb>
                                            <Thumb Style="{StaticResource DarkScrollBarThumb}"/>
                                        </Track.Thumb>
                                    </Track>
                                </Border>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Apply dark scrollbars globally -->
        <Style TargetType="ScrollBar" BasedOn="{StaticResource DarkScrollBar}"/>

        <!-- Dark ScrollViewer with proper padding -->
        <Style x:Key="DarkScrollViewer" TargetType="ScrollViewer">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollViewer">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <ScrollContentPresenter Grid.Column="0" Grid.Row="0" Margin="0,0,4,0"/>
                            <ScrollBar x:Name="PART_VerticalScrollBar" Grid.Column="1" Grid.Row="0"
                                       Value="{TemplateBinding VerticalOffset}"
                                       Maximum="{TemplateBinding ScrollableHeight}"
                                       ViewportSize="{TemplateBinding ViewportHeight}"
                                       Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}"
                                       Style="{StaticResource DarkScrollBar}"/>
                            <ScrollBar x:Name="PART_HorizontalScrollBar" Grid.Column="0" Grid.Row="1"
                                       Orientation="Horizontal"
                                       Value="{TemplateBinding HorizontalOffset}"
                                       Maximum="{TemplateBinding ScrollableWidth}"
                                       ViewportSize="{TemplateBinding ViewportWidth}"
                                       Visibility="{TemplateBinding ComputedHorizontalScrollBarVisibility}"
                                       Style="{StaticResource DarkScrollBar}"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DarkListBox" TargetType="ListBox">
            <Setter Property="Background" Value="#2D2D2D"/>
            <Setter Property="Foreground" Value="#E0E0E0"/>
            <Setter Property="BorderBrush" Value="#3E3E3E"/>
        </Style>

        <!-- ComboBox Toggle Button -->
        <ControlTemplate x:Key="DarkComboBoxToggleButton" TargetType="ToggleButton">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition/>
                    <ColumnDefinition Width="20"/>
                </Grid.ColumnDefinitions>
                <Border x:Name="Border" Grid.ColumnSpan="2" Background="#2D2D2D" BorderBrush="#3E3E3E" BorderThickness="1" CornerRadius="2"/>
                <Border Grid.Column="0" Background="#2D2D2D" BorderBrush="#3E3E3E" BorderThickness="0" CornerRadius="2,0,0,2" Margin="1"/>
                <Path x:Name="Arrow" Grid.Column="1" Fill="#E0E0E0" HorizontalAlignment="Center" VerticalAlignment="Center"
                      Data="M 0 0 L 4 4 L 8 0 Z"/>
            </Grid>
        </ControlTemplate>

        <Style x:Key="DarkComboBox" TargetType="ComboBox">
            <Setter Property="Foreground" Value="#E0E0E0"/>
            <Setter Property="Background" Value="#2D2D2D"/>
            <Setter Property="BorderBrush" Value="#3E3E3E"/>
            <Setter Property="Padding" Value="5,3"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <ToggleButton x:Name="ToggleButton" Template="{StaticResource DarkComboBoxToggleButton}"
                                          Focusable="False" ClickMode="Press"
                                          IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"/>
                            <ContentPresenter x:Name="ContentSite" IsHitTestVisible="False"
                                              Content="{TemplateBinding SelectionBoxItem}"
                                              ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                              ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                              Margin="6,3,23,3" VerticalAlignment="Center" HorizontalAlignment="Left"
                                              TextElement.Foreground="#E0E0E0"/>
                            <Popup x:Name="Popup" Placement="Bottom" IsOpen="{TemplateBinding IsDropDownOpen}"
                                   AllowsTransparency="True" Focusable="False" PopupAnimation="Slide">
                                <Grid x:Name="DropDown" SnapsToDevicePixels="True"
                                      MinWidth="{TemplateBinding ActualWidth}" MaxHeight="{TemplateBinding MaxDropDownHeight}">
                                    <Border x:Name="DropDownBorder" Background="#2D2D2D" BorderBrush="#3E3E3E" BorderThickness="1"/>
                                    <ScrollViewer Margin="2" SnapsToDevicePixels="True">
                                        <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained"/>
                                    </ScrollViewer>
                                </Grid>
                            </Popup>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DarkComboBoxItem" TargetType="ComboBoxItem">
            <Setter Property="Background" Value="#2D2D2D"/>
            <Setter Property="Foreground" Value="#E0E0E0"/>
            <Setter Property="Padding" Value="5,3"/>
            <Style.Triggers>
                <Trigger Property="IsHighlighted" Value="True">
                    <Setter Property="Background" Value="#0078D4"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#3E3E3E"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="DarkSlider" TargetType="Slider">
            <Setter Property="Background" Value="#3E3E3E"/>
            <Setter Property="Foreground" Value="#0078D4"/>
        </Style>

        <!-- Dark TabControl Styles -->
        <Style x:Key="DarkTabControl" TargetType="TabControl">
            <Setter Property="Background" Value="#1E1E1E"/>
            <Setter Property="BorderBrush" Value="#3E3E3E"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="0"/>
        </Style>

        <Style x:Key="DarkTabItem" TargetType="TabItem">
            <Setter Property="Background" Value="#2D2D2D"/>
            <Setter Property="Foreground" Value="#A0A0A0"/>
            <Setter Property="BorderBrush" Value="#3E3E3E"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border x:Name="Border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="1,1,1,0"
                                CornerRadius="4,4,0,0"
                                Padding="{TemplateBinding Padding}"
                                Margin="0,0,2,0">
                            <ContentPresenter x:Name="ContentSite"
                                              ContentSource="Header"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="#3E3E3E"/>
                                <Setter Property="Foreground" Value="#E0E0E0"/>
                                <Setter TargetName="Border" Property="BorderBrush" Value="#0078D4"/>
                                <Setter TargetName="Border" Property="BorderThickness" Value="1,2,1,0"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#3A3A3A"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Dark DataGrid Styles -->
        <Style x:Key="DarkDataGrid" TargetType="DataGrid">
            <Setter Property="Background" Value="#2D2D2D"/>
            <Setter Property="Foreground" Value="#E0E0E0"/>
            <Setter Property="BorderBrush" Value="#3E3E3E"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HorizontalGridLinesBrush" Value="#3E3E3E"/>
            <Setter Property="RowHeaderWidth" Value="0"/>
            <Setter Property="AlternatingRowBackground" Value="#252525"/>
            <Setter Property="RowBackground" Value="#2D2D2D"/>
        </Style>

        <Style x:Key="DarkDataGridCell" TargetType="DataGridCell">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#E0E0E0"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="Padding" Value="5,2"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#0078D4"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="DarkDataGridRow" TargetType="DataGridRow">
            <Setter Property="Background" Value="#2D2D2D"/>
            <Setter Property="Foreground" Value="#E0E0E0"/>
            <Style.Triggers>
                <Trigger Property="AlternationIndex" Value="1">
                    <Setter Property="Background" Value="#252525"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#0078D4"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#3A3A3A"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- DataGrid Row Style with Error Tooltip -->
        <Style x:Key="DarkDataGridRowWithTooltip" TargetType="DataGridRow" BasedOn="{StaticResource DarkDataGridRow}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Status}" Value="Failed">
                    <Setter Property="ToolTip">
                        <Setter.Value>
                            <ToolTip Background="#2D2D2D" BorderBrush="#FF6B6B" BorderThickness="2">
                                <StackPanel MaxWidth="400">
                                    <TextBlock Text="CHUNK ERROR DETAILS" FontWeight="Bold" Foreground="#FF6B6B" Margin="0,0,0,10"/>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                        <TextBlock Text="Exit Code: " Foreground="#808080" FontWeight="SemiBold"/>
                                        <TextBlock Text="{Binding LastExitCode}" Foreground="#E0E0E0"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                        <TextBlock Text="Error: " Foreground="#808080" FontWeight="SemiBold"/>
                                        <TextBlock Text="{Binding LastErrorMessage}" Foreground="#FFB340" TextWrapping="Wrap"/>
                                    </StackPanel>
                                    <Separator Background="#3E3E3E" Margin="0,10"/>
                                    <StackPanel Orientation="Horizontal" Margin="0,5,0,5">
                                        <TextBlock Text="Source: " Foreground="#808080" FontWeight="SemiBold"/>
                                        <TextBlock Text="{Binding SourcePath}" Foreground="#E0E0E0" TextWrapping="Wrap"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                        <TextBlock Text="Destination: " Foreground="#808080" FontWeight="SemiBold"/>
                                        <TextBlock Text="{Binding DestinationPath}" Foreground="#E0E0E0" TextWrapping="Wrap"/>
                                    </StackPanel>
                                </StackPanel>
                            </ToolTip>
                        </Setter.Value>
                    </Setter>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="DarkDataGridColumnHeader" TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="#1E1E1E"/>
            <Setter Property="Foreground" Value="#E0E0E0"/>
            <Setter Property="BorderBrush" Value="#3E3E3E"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="Padding" Value="8,5"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>

        <!-- Dark ContextMenu Style -->
        <Style x:Key="DarkContextMenu" TargetType="ContextMenu">
            <Setter Property="Background" Value="#2D2D2D"/>
            <Setter Property="Foreground" Value="#E0E0E0"/>
            <Setter Property="BorderBrush" Value="#3E3E3E"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <Style x:Key="DarkMenuItem" TargetType="MenuItem">
            <Setter Property="Background" Value="#2D2D2D"/>
            <Setter Property="Foreground" Value="#E0E0E0"/>
            <Setter Property="Padding" Value="8,5"/>
            <Style.Triggers>
                <Trigger Property="IsHighlighted" Value="True">
                    <Setter Property="Background" Value="#0078D4"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Foreground" Value="#707070"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- NEW: Rail Button Style for Navigation -->
        <Style x:Key="RailButton" TargetType="RadioButton">
            <Setter Property="Width" Value="50"/>
            <Setter Property="Height" Value="50"/>
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="Foreground" Value="#808080"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderThickness="3,0,0,0"
                                BorderBrush="Transparent">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter Property="Background" Value="#3E3E3E"/>
                                <Setter Property="Foreground" Value="#E0E0E0"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="#0078D4"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#2D2D2D"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <!-- ==================== MAIN GRID LAYOUT ==================== -->
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>      <!-- Content area -->
            <RowDefinition Height="Auto"/>   <!-- Bottom control bar -->
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="50"/>   <!-- Navigation rail -->
            <ColumnDefinition Width="*"/>    <!-- Content panels -->
        </Grid.ColumnDefinitions>

        <!-- ==================== NAVIGATION RAIL ==================== -->
        <Border Grid.Row="0" Grid.Column="0" Background="#252525">
            <StackPanel>
                <RadioButton x:Name="btnNavProfiles"
                             GroupName="NavRail"
                             IsChecked="True"
                             Style="{StaticResource RailButton}"
                             Content="&#x2630;"
                             ToolTip="Profiles (1)"/>
                <RadioButton x:Name="btnNavSettings"
                             GroupName="NavRail"
                             Style="{StaticResource RailButton}"
                             Content="&#x2699;"
                             ToolTip="Settings (2)"/>
                <RadioButton x:Name="btnNavProgress"
                             GroupName="NavRail"
                             Style="{StaticResource RailButton}"
                             Content="&#x1F4CA;"
                             ToolTip="Progress (3)"/>
                <RadioButton x:Name="btnNavLogs"
                             GroupName="NavRail"
                             Style="{StaticResource RailButton}"
                             Content="&#x1F4DC;"
                             ToolTip="Logs (4)"/>
                <RadioButton x:Name="btnNavSnapshots"
                             GroupName="NavRail"
                             Style="{StaticResource RailButton}"
                             Content="&#x1F4F7;"
                             ToolTip="Snapshots (5)"/>
            </StackPanel>
        </Border>

        <!-- ==================== CONTENT PANELS ==================== -->
        <Grid Grid.Row="0" Grid.Column="1">

            <!-- ==================== PROFILES PANEL ==================== -->
            <Grid x:Name="panelProfiles" Visibility="Visible" Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Profile List Sidebar -->
                <Border Grid.Row="0" Grid.RowSpan="2" Grid.Column="0" Background="#252525" CornerRadius="4" Margin="0,0,10,0" Padding="10">
                    <DockPanel>
                        <Label DockPanel.Dock="Top" Content="Sync Profiles" Style="{StaticResource DarkLabel}" FontWeight="Bold"/>
                        <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" Margin="0,10,0,0">
                            <Button x:Name="btnAddProfile" Content="+ Add" Style="{StaticResource DarkButton}" Width="70" Margin="0,0,5,0"
                                    ToolTip="Add a new sync profile"/>
                            <Button x:Name="btnRemoveProfile" Content="Remove" Style="{StaticResource DarkButton}" Width="70"
                                    ToolTip="Remove selected profile"/>
                        </StackPanel>
                        <ListBox x:Name="lstProfiles" Style="{StaticResource DarkListBox}" Margin="0,5,0,0"
                                 ToolTip="List of configured sync profiles">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <CheckBox IsChecked="{Binding Enabled}" Content="{Binding Name}"
                                              Style="{StaticResource DarkCheckBox}"/>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </DockPanel>
                </Border>

                <!-- Profile Settings Editor -->
                <Border Grid.Row="0" Grid.RowSpan="2" Grid.Column="1" Background="#252525" CornerRadius="4" Padding="15">
                    <Grid>
                        <!-- Main profile settings content -->
                        <Grid x:Name="pnlProfileSettingsContent">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*" MinHeight="80"/>
                            </Grid.RowDefinitions>

                            <!-- Scrollable settings area - expands first -->
                            <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="80"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="70"/>
                                </Grid.ColumnDefinitions>

                                <Label Grid.Row="0" Content="Name:" Style="{StaticResource DarkLabel}" VerticalAlignment="Center" Margin="0,0,0,8"/>
                                <TextBox Grid.Row="0" Grid.Column="1" Grid.ColumnSpan="2" x:Name="txtProfileName"
                                         Style="{StaticResource DarkTextBox}" Margin="0,0,0,8"
                                         ToolTip="Profile display name"/>

                                <Label Grid.Row="1" Content="Source:" Style="{StaticResource DarkLabel}" VerticalAlignment="Center" Margin="0,0,0,8"/>
                                <TextBox Grid.Row="1" Grid.Column="1" x:Name="txtSource" Style="{StaticResource DarkTextBox}" Margin="0,0,5,8"
                                         ToolTip="Source path to copy from"/>
                                <Button Grid.Row="1" Grid.Column="2" x:Name="btnBrowseSource" Content="Browse"
                                        Style="{StaticResource DarkButton}" VerticalAlignment="Center" Margin="0,0,0,8"/>

                                <Label Grid.Row="2" Content="Destination:" Style="{StaticResource DarkLabel}" VerticalAlignment="Center" Margin="0,0,0,8"/>
                                <TextBox Grid.Row="2" Grid.Column="1" x:Name="txtDest" Style="{StaticResource DarkTextBox}" Margin="0,0,5,8"
                                         ToolTip="Destination path"/>
                                <Button Grid.Row="2" Grid.Column="2" x:Name="btnBrowseDest" Content="Browse"
                                        Style="{StaticResource DarkButton}" VerticalAlignment="Center" Margin="0,0,0,8"/>

                                <!-- Chunking - after Destination -->
                                <Label Grid.Row="3" Grid.Column="0" Content="Chunking:" Style="{StaticResource DarkLabel}" VerticalAlignment="Center" Margin="0,0,0,8"/>
                                <StackPanel Grid.Row="3" Grid.Column="1" Grid.ColumnSpan="2" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,8">
                                    <TextBox x:Name="txtMaxSize" Width="40" Style="{StaticResource DarkTextBox}" Text="10"
                                             ToolTip="Max size (GB)"/>
                                    <Label Content="GB" Style="{StaticResource DarkLabel}" VerticalAlignment="Center"/>
                                    <TextBox x:Name="txtMaxFiles" Width="50" Style="{StaticResource DarkTextBox}" Text="50000" Margin="10,0,0,0"
                                             ToolTip="Max files"/>
                                    <Label Content="files" Style="{StaticResource DarkLabel}" VerticalAlignment="Center"/>
                                    <TextBox x:Name="txtMaxDepth" Width="30" Style="{StaticResource DarkTextBox}" Text="5" Margin="10,0,0,0"
                                             ToolTip="Max depth"/>
                                    <Label Content="depth" Style="{StaticResource DarkLabel}" VerticalAlignment="Center"/>
                                </StackPanel>

                                <!-- Scan + Validate on same row -->
                                <Label Grid.Row="4" Grid.Column="0" Content="Scan:" Style="{StaticResource DarkLabel}" VerticalAlignment="Center" Margin="0,0,0,8"/>
                                <ComboBox Grid.Row="4" Grid.Column="1" x:Name="cmbScanMode" Width="80" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="0,0,0,8"
                                          Style="{StaticResource DarkComboBox}"
                                          ToolTip="Scan mode: Smart or Quick">
                                    <ComboBoxItem Content="Smart" IsSelected="True" Style="{StaticResource DarkComboBoxItem}"/>
                                    <ComboBoxItem Content="Quick" Style="{StaticResource DarkComboBoxItem}"/>
                                </ComboBox>
                                <StackPanel Grid.Row="4" Grid.Column="1" Grid.ColumnSpan="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,0,8">
                                    <Button x:Name="btnProfileSchedule" Content="Schedule" Style="{StaticResource ScheduleButton}"
                                            VerticalAlignment="Center" Margin="0,0,8,0"
                                            ToolTip="Configure scheduled runs for this profile"/>
                                    <Button x:Name="btnValidateProfile" Content="Validate" Style="{StaticResource ValidateButton}"
                                            VerticalAlignment="Center"
                                            ToolTip="Run pre-flight validation checks"/>
                                </StackPanel>

                                <!-- Snapshot Configuration TabControl -->
                                <TabControl Grid.Row="5" Grid.Column="0" Grid.ColumnSpan="3" x:Name="tabSnapshotConfig"
                                            Style="{StaticResource DarkTabControl}" Margin="0,5,0,5" Height="130">
                                    <!-- Source Snapshots Tab -->
                                    <TabItem Header="Source Snapshots" Style="{StaticResource DarkTabItem}">
                                        <Border Margin="5" Background="#252525" CornerRadius="4" Padding="10">
                                            <StackPanel>
                                                <CheckBox x:Name="chkUseVss" Content="Use temporary VSS for backup (copy locked files)"
                                                          Foreground="#E0E0E0" Margin="0,0,0,8"
                                                          ToolTip="Create temporary VSS snapshot during sync to copy locked files"/>
                                                <CheckBox x:Name="chkSourcePersistentSnapshot"
                                                          Content="Create persistent snapshot before backup"
                                                          Foreground="#E0E0E0" Margin="0,0,0,8"
                                                          ToolTip="Creates a persistent VSS snapshot on SOURCE volume before backup"/>
                                                <StackPanel Orientation="Horizontal" Margin="20,0,0,0">
                                                    <Label Content="Retention:" Foreground="#808080" VerticalAlignment="Center" Padding="0,0,5,0"/>
                                                    <TextBox x:Name="txtSourceRetentionCount" Text="3" Width="50"
                                                             Background="#2D2D2D" Foreground="#E0E0E0" BorderBrush="#3E3E3E"
                                                             TextAlignment="Center" Margin="0,0,5,0"
                                                             ToolTip="Number of snapshots to keep on source volume"/>
                                                    <Label Content="snapshots" Foreground="#808080" VerticalAlignment="Center" Padding="0"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </Border>
                                    </TabItem>
                                    <!-- Destination Snapshots Tab -->
                                    <TabItem Header="Dest Snapshots" Style="{StaticResource DarkTabItem}">
                                        <Border Margin="5" Background="#252525" CornerRadius="4" Padding="10">
                                            <StackPanel>
                                                <CheckBox x:Name="chkDestPersistentSnapshot"
                                                          Content="Create persistent snapshot before backup"
                                                          Foreground="#E0E0E0" Margin="0,0,0,8"
                                                          ToolTip="Creates a persistent VSS snapshot on DESTINATION volume before backup"/>
                                                <StackPanel Orientation="Horizontal" Margin="20,0,0,0">
                                                    <Label Content="Retention:" Foreground="#808080" VerticalAlignment="Center" Padding="0,0,5,0"/>
                                                    <TextBox x:Name="txtDestRetentionCount" Text="3" Width="50"
                                                             Background="#2D2D2D" Foreground="#E0E0E0" BorderBrush="#3E3E3E"
                                                             TextAlignment="Center" Margin="0,0,5,0"
                                                             ToolTip="Number of snapshots to keep on destination volume"/>
                                                    <Label Content="snapshots" Foreground="#808080" VerticalAlignment="Center" Padding="0"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </Border>
                                    </TabItem>
                                </TabControl>
                            </Grid>
                        </ScrollViewer>

                        <!-- Snapshot Management TabControl - OUTSIDE ScrollViewer so it expands -->
                        <TabControl Grid.Row="1" x:Name="tabProfileSnapshots"
                                    Style="{StaticResource DarkTabControl}" Margin="0,10,0,0">
                            <!-- Source Snapshots List -->
                            <TabItem Header="Source Snapshots" Style="{StaticResource DarkTabItem}">
                                <Grid Margin="5">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <DataGrid x:Name="dgSourceSnapshots" Grid.Row="0"
                                              Style="{StaticResource DarkDataGrid}"
                                              ColumnHeaderStyle="{StaticResource DarkDataGridColumnHeader}"
                                              CellStyle="{StaticResource DarkDataGridCell}"
                                              RowStyle="{StaticResource DarkDataGridRow}"
                                              AutoGenerateColumns="False" IsReadOnly="True" SelectionMode="Single">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Created" Binding="{Binding CreatedAt, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" Width="120"/>
                                            <DataGridTextColumn Header="Shadow ID" Binding="{Binding ShadowId}" Width="*"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,5,0,0">
                                        <Button x:Name="btnRefreshSourceSnapshots" Content="Refresh" Width="70"
                                                Style="{StaticResource DarkButton}" Margin="0,0,5,0"/>
                                        <Button x:Name="btnDeleteSourceSnapshot" Content="Delete" Width="70"
                                                Style="{StaticResource StopButton}" IsEnabled="False"/>
                                    </StackPanel>
                                </Grid>
                            </TabItem>
                            <!-- Destination Snapshots List -->
                            <TabItem Header="Dest Snapshots" Style="{StaticResource DarkTabItem}">
                                <Grid Margin="5">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <DataGrid x:Name="dgDestSnapshots" Grid.Row="0"
                                              Style="{StaticResource DarkDataGrid}"
                                              ColumnHeaderStyle="{StaticResource DarkDataGridColumnHeader}"
                                              CellStyle="{StaticResource DarkDataGridCell}"
                                              RowStyle="{StaticResource DarkDataGridRow}"
                                              AutoGenerateColumns="False" IsReadOnly="True" SelectionMode="Single">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Created" Binding="{Binding CreatedAt, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" Width="120"/>
                                            <DataGridTextColumn Header="Shadow ID" Binding="{Binding ShadowId}" Width="*"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,5,0,0">
                                        <Button x:Name="btnRefreshDestSnapshots" Content="Refresh" Width="70"
                                                Style="{StaticResource DarkButton}" Margin="0,0,5,0"/>
                                        <Button x:Name="btnDeleteDestSnapshot" Content="Delete" Width="70"
                                                Style="{StaticResource StopButton}" IsEnabled="False"/>
                                    </StackPanel>
                                </Grid>
                            </TabItem>
                        </TabControl>
                        </Grid>

                        <!-- No Profile Selected Overlay -->
                        <Border x:Name="pnlNoProfileMessage" Background="#252525" Visibility="Visible">
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                <TextBlock Text="No Profile Selected"
                                           FontSize="18" FontWeight="SemiBold" Foreground="#808080"
                                           HorizontalAlignment="Center" Margin="0,0,0,10"/>
                                <TextBlock Text="Click '+ Add' to create a profile"
                                           FontSize="13" Foreground="#606060"
                                           HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </Border>
            </Grid>

            <!-- ==================== SETTINGS PANEL ==================== -->
            <Grid x:Name="panelSettings" Visibility="Collapsed" Margin="10">
                <Border Background="#252525" CornerRadius="4" Padding="15">
                    <DockPanel>
                        <!-- Button bar at bottom -->
                        <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,15,0,0">
                            <Button x:Name="btnSettingsRevert" Content="Revert" Style="{StaticResource DarkButton}" Width="90" Margin="0,0,10,0"
                                    ToolTip="Revert changes and reload current settings"/>
                            <Button x:Name="btnSettingsSave" Content="Save" Style="{StaticResource RunButton}" Width="90"
                                    ToolTip="Save settings to configuration file"/>
                        </StackPanel>

                        <!-- Scrollable settings content -->
                        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                            <StackPanel>
                                <!-- PERFORMANCE Section -->
                                <TextBlock Text="PERFORMANCE" FontWeight="Bold" Foreground="#0078D4" Margin="0,0,0,10"/>
                                <Border Background="#1E1E1E" CornerRadius="4" Padding="15" Margin="0,0,0,20">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="150"/>
                                            <ColumnDefinition Width="200"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Concurrent Jobs -->
                                        <Label Grid.Row="0" Content="Concurrent Jobs:" Style="{StaticResource DarkLabel}" VerticalAlignment="Center" Margin="0,0,0,10"/>
                                        <Slider Grid.Row="0" Grid.Column="1" x:Name="sldSettingsJobs" Minimum="1" Maximum="16" Value="4"
                                                Style="{StaticResource DarkSlider}"
                                                TickFrequency="1" IsSnapToTickEnabled="True" VerticalAlignment="Center" Margin="0,0,10,10"/>
                                        <TextBlock Grid.Row="0" Grid.Column="2" x:Name="txtSettingsJobs" Text="4" Foreground="#E0E0E0"
                                                   VerticalAlignment="Center" Margin="0,0,0,10"/>

                                        <!-- Threads per Job -->
                                        <Label Grid.Row="1" Content="Threads per Job:" Style="{StaticResource DarkLabel}" VerticalAlignment="Center" Margin="0,0,0,10"/>
                                        <Slider Grid.Row="1" Grid.Column="1" x:Name="sldSettingsThreads" Minimum="1" Maximum="32" Value="8"
                                                Style="{StaticResource DarkSlider}"
                                                TickFrequency="1" IsSnapToTickEnabled="True" VerticalAlignment="Center" Margin="0,0,10,10"/>
                                        <TextBlock Grid.Row="1" Grid.Column="2" x:Name="txtSettingsThreads" Text="8" Foreground="#E0E0E0"
                                                   VerticalAlignment="Center" Margin="0,0,0,10"/>

                                        <!-- Bandwidth Limit -->
                                        <Label Grid.Row="2" Content="Bandwidth Limit:" Style="{StaticResource DarkLabel}" VerticalAlignment="Center"/>
                                        <TextBox Grid.Row="2" Grid.Column="1" x:Name="txtSettingsBandwidth" Text="0" Style="{StaticResource DarkTextBox}"
                                                 VerticalAlignment="Center" Margin="0,0,10,0"/>
                                        <Label Grid.Row="2" Grid.Column="2" Content="MB/s (0 = unlimited)" Style="{StaticResource DarkLabel}"
                                               VerticalAlignment="Center" Foreground="#808080"/>
                                    </Grid>
                                </Border>

                                <!-- LOGGING Section -->
                                <TextBlock Text="LOGGING" FontWeight="Bold" Foreground="#0078D4" Margin="0,0,0,10"/>
                                <Border Background="#1E1E1E" CornerRadius="4" Padding="15" Margin="0,0,0,20">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="150"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="80"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Log Path -->
                                        <Label Grid.Row="0" Content="Log Path:" Style="{StaticResource DarkLabel}" VerticalAlignment="Center" Margin="0,0,0,10"/>
                                        <TextBox Grid.Row="0" Grid.Column="1" x:Name="txtSettingsLogPath" Text=".\Logs" Style="{StaticResource DarkTextBox}"
                                                 VerticalAlignment="Center" Margin="0,0,5,10"/>
                                        <Button Grid.Row="0" Grid.Column="2" x:Name="btnSettingsLogBrowse" Content="Browse" Style="{StaticResource DarkButton}"
                                                VerticalAlignment="Center" Margin="0,0,0,10"/>

                                        <!-- Log Level -->
                                        <Label Grid.Row="1" Content="Log Level:" Style="{StaticResource DarkLabel}" VerticalAlignment="Center" Margin="0,0,0,10"/>
                                        <ComboBox Grid.Row="1" Grid.Column="1" x:Name="cmbSettingsLogLevel" Width="120" HorizontalAlignment="Left"
                                                  Style="{StaticResource DarkComboBox}" VerticalAlignment="Center" Margin="0,0,0,10">
                                            <ComboBoxItem Content="Debug" Style="{StaticResource DarkComboBoxItem}"/>
                                            <ComboBoxItem Content="Info" Style="{StaticResource DarkComboBoxItem}" IsSelected="True"/>
                                            <ComboBoxItem Content="Warning" Style="{StaticResource DarkComboBoxItem}"/>
                                            <ComboBoxItem Content="Error" Style="{StaticResource DarkComboBoxItem}"/>
                                        </ComboBox>

                                        <!-- Verbose File Logging -->
                                        <Label Grid.Row="2" Content="File Logging:" Style="{StaticResource DarkLabel}" VerticalAlignment="Top" Margin="0,0,0,10"/>
                                        <StackPanel Grid.Row="2" Grid.Column="1" Grid.ColumnSpan="2" Margin="0,0,0,10">
                                            <CheckBox x:Name="chkSettingsVerboseLogging" Content="Log individual file operations"
                                                      Style="{StaticResource DarkCheckBox}" VerticalAlignment="Center"/>
                                            <TextBlock Text="Required for failed file reporting. Increases log file size."
                                                       FontSize="11" Foreground="#808080" Margin="20,2,0,0" TextWrapping="Wrap"/>
                                        </StackPanel>

                                        <!-- Enable SIEM -->
                                        <Label Grid.Row="3" Content="Enable SIEM:" Style="{StaticResource DarkLabel}" VerticalAlignment="Center" Margin="0,0,0,10"/>
                                        <CheckBox Grid.Row="3" Grid.Column="1" Grid.ColumnSpan="2" x:Name="chkSettingsSiem" Content="Enable JSON Lines logging for SIEM"
                                                  Style="{StaticResource DarkCheckBox}" VerticalAlignment="Center" Margin="0,0,0,10"/>

                                        <!-- SIEM Path -->
                                        <Label Grid.Row="4" Content="SIEM Path:" Style="{StaticResource DarkLabel}" VerticalAlignment="Center"/>
                                        <TextBox Grid.Row="4" Grid.Column="1" x:Name="txtSettingsSiemPath" Text=".\Logs\SIEM" Style="{StaticResource DarkTextBox}"
                                                 VerticalAlignment="Center" Margin="0,0,5,0"/>
                                        <Button Grid.Row="4" Grid.Column="2" x:Name="btnSettingsSiemBrowse" Content="Browse" Style="{StaticResource DarkButton}"
                                                VerticalAlignment="Center"/>
                                    </Grid>
                                </Border>

                                <!-- EMAIL NOTIFICATIONS Section -->
                                <TextBlock Text="EMAIL NOTIFICATIONS" FontWeight="Bold" Foreground="#0078D4" Margin="0,0,0,10"/>
                                <Border Background="#1E1E1E" CornerRadius="4" Padding="15" Margin="0,0,0,20">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="150"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="80"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Enable Email -->
                                        <Label Grid.Row="0" Content="Enable Email:" Style="{StaticResource DarkLabel}" VerticalAlignment="Center" Margin="0,0,0,10"/>
                                        <CheckBox Grid.Row="0" Grid.Column="1" Grid.ColumnSpan="2" x:Name="chkSettingsEmailEnabled" Content="Send email notifications on completion"
                                                  Style="{StaticResource DarkCheckBox}" VerticalAlignment="Center" Margin="0,0,0,10"/>

                                        <!-- SMTP Server and Port -->
                                        <Label Grid.Row="1" Content="SMTP Server:" Style="{StaticResource DarkLabel}" VerticalAlignment="Center" Margin="0,0,0,10"/>
                                        <StackPanel Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="2" Orientation="Horizontal" Margin="0,0,0,10">
                                            <TextBox x:Name="txtSettingsSmtp" Text="" Style="{StaticResource DarkTextBox}" Width="250" Margin="0,0,10,0"/>
                                            <Label Content="Port:" Style="{StaticResource DarkLabel}" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                            <TextBox x:Name="txtSettingsSmtpPort" Text="587" Style="{StaticResource DarkTextBox}" Width="60"/>
                                        </StackPanel>

                                        <!-- Use TLS -->
                                        <Label Grid.Row="2" Content="Use TLS:" Style="{StaticResource DarkLabel}" VerticalAlignment="Center" Margin="0,0,0,10"/>
                                        <CheckBox Grid.Row="2" Grid.Column="1" Grid.ColumnSpan="2" x:Name="chkSettingsTls" Content="Use TLS/SSL encryption"
                                                  Style="{StaticResource DarkCheckBox}" VerticalAlignment="Center" IsChecked="True" Margin="0,0,0,10"/>

                                        <!-- Credential -->
                                        <Label Grid.Row="3" Content="Credential:" Style="{StaticResource DarkLabel}" VerticalAlignment="Center" Margin="0,0,0,10"/>
                                        <TextBox Grid.Row="3" Grid.Column="1" x:Name="txtSettingsCredential" Text="Robocurse-SMTP"
                                                 Style="{StaticResource DarkTextBox}" Margin="0,0,5,10"
                                                 ToolTip="Windows Credential Manager target name"/>
                                        <Button Grid.Row="3" Grid.Column="2" x:Name="btnSettingsSetCredential" Content="Set..."
                                                Style="{StaticResource DarkButton}" VerticalAlignment="Center" Margin="0,0,0,10"
                                                ToolTip="Set SMTP username and password"/>

                                        <!-- From -->
                                        <Label Grid.Row="4" Content="From:" Style="{StaticResource DarkLabel}" VerticalAlignment="Center" Margin="0,0,0,10"/>
                                        <TextBox Grid.Row="4" Grid.Column="1" Grid.ColumnSpan="2" x:Name="txtSettingsEmailFrom" Text=""
                                                 Style="{StaticResource DarkTextBox}" Margin="0,0,0,10"/>

                                        <!-- To -->
                                        <Label Grid.Row="5" Content="To:" Style="{StaticResource DarkLabel}" VerticalAlignment="Top" Margin="0,5,0,0"/>
                                        <TextBox Grid.Row="5" Grid.Column="1" Grid.ColumnSpan="2" x:Name="txtSettingsEmailTo" Text=""
                                                 Style="{StaticResource DarkTextBox}" Height="60"
                                                 AcceptsReturn="True" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"
                                                 ToolTip="One email address per line"/>
                                    </Grid>
                                </Border>

                                <!-- SCHEDULE Section -->
                                <TextBlock Text="SCHEDULE" FontWeight="Bold" Foreground="#0078D4" Margin="0,0,0,10"/>
                                <Border Background="#1E1E1E" CornerRadius="4" Padding="15" Margin="0,0,0,0">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="150"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Schedule Status -->
                                        <Label Grid.Row="0" Content="Status:" Style="{StaticResource DarkLabel}" VerticalAlignment="Center" Margin="0,0,0,10"/>
                                        <TextBlock Grid.Row="0" Grid.Column="1" x:Name="txtSettingsScheduleStatus" Text="Not configured" Foreground="#808080"
                                                   VerticalAlignment="Center" Margin="0,0,0,10"/>

                                        <!-- Configure Button -->
                                        <Button Grid.Row="1" Grid.Column="1" x:Name="btnSettingsSchedule" Content="Configure Schedule..."
                                                Style="{StaticResource ScheduleButton}" Width="150" HorizontalAlignment="Left"
                                                ToolTip="Configure Windows Task Scheduler"/>
                                    </Grid>
                                </Border>

                            </StackPanel>
                        </ScrollViewer>
                    </DockPanel>
                </Border>
            </Grid>

            <!-- ==================== SNAPSHOTS PANEL ==================== -->
            <Grid x:Name="panelSnapshots" Visibility="Collapsed" Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Header and Filter Bar -->
                <Border Grid.Row="0" Background="#252525" CornerRadius="4" Padding="10" Margin="0,0,0,10">
                    <StackPanel>
                        <Label Content="VSS Snapshots" Style="{StaticResource DarkLabel}" FontSize="14" FontWeight="Bold" Margin="0,0,0,10"/>
                        <StackPanel Orientation="Horizontal">
                            <Label Content="Volume:" Style="{StaticResource DarkLabel}" VerticalAlignment="Center"/>
                            <ComboBox x:Name="cmbSnapshotVolume" Width="100" Margin="5,0"
                                      Style="{StaticResource DarkComboBox}"
                                      ToolTip="Filter by volume">
                                <ComboBoxItem Content="All Volumes" IsSelected="True" Style="{StaticResource DarkComboBoxItem}"/>
                            </ComboBox>

                            <Label Content="Server:" Style="{StaticResource DarkLabel}" VerticalAlignment="Center" Margin="20,0,0,0"/>
                            <ComboBox x:Name="cmbSnapshotServer" Width="150" Margin="5,0"
                                      Style="{StaticResource DarkComboBox}"
                                      ToolTip="Filter by server (local or remote)">
                                <ComboBoxItem Content="Local" IsSelected="True" Style="{StaticResource DarkComboBoxItem}"/>
                            </ComboBox>

                            <Button x:Name="btnRefreshSnapshots" Content="Refresh" Width="80" Margin="20,0,0,0"
                                    Style="{StaticResource DarkButton}"
                                    ToolTip="Reload snapshot list"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Snapshot DataGrid -->
                <DataGrid x:Name="dgSnapshots" Grid.Row="1" Margin="0,0,0,10"
                          Style="{StaticResource DarkDataGrid}"
                          CellStyle="{StaticResource DarkDataGridCell}"
                          RowStyle="{StaticResource DarkDataGridRow}"
                          ColumnHeaderStyle="{StaticResource DarkDataGridColumnHeader}"
                          AlternationCount="2"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          SelectionMode="Single"
                          CanUserSortColumns="True"
                          CanUserReorderColumns="False">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Volume" Binding="{Binding SourceVolume}" Width="70"/>
                        <DataGridTextColumn Header="Created" Binding="{Binding CreatedAt, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" Width="140"/>
                        <DataGridTextColumn Header="Server" Binding="{Binding ServerName}" Width="120"/>
                        <DataGridTextColumn Header="Shadow ID" Binding="{Binding ShadowId}" Width="*">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                    <Setter Property="ToolTip" Value="{Binding ShadowId}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Action Buttons -->
                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0">
                    <Button x:Name="btnCreateSnapshot" Content="Create Snapshot" Width="120"
                            Style="{StaticResource RunButton}"
                            ToolTip="Create a new VSS snapshot"/>
                    <Button x:Name="btnDeleteSnapshot" Content="Delete Selected" Width="120" Margin="10,0,0,0"
                            Style="{StaticResource StopButton}"
                            IsEnabled="False"
                            ToolTip="Delete the selected snapshot"/>
                </StackPanel>
            </Grid>

            <!-- ==================== PROGRESS PANEL ==================== -->
            <Grid x:Name="panelProgress" Visibility="Collapsed" Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Progress Summary -->
                <Border Grid.Row="0" Background="#252525" CornerRadius="4" Padding="10" Margin="0,0,0,10">
                    <StackPanel>
                        <!-- Main progress row -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="150"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock x:Name="txtProfileProgress" Text="Profile: --" Foreground="#E0E0E0" Margin="0,0,0,5"/>
                                <ProgressBar x:Name="pbProfile" Height="20" Minimum="0" Maximum="100" Value="0"
                                             Background="#1A1A1A" Foreground="#00BFFF" BorderBrush="#555555" BorderThickness="1"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1" Margin="15,0,0,0">
                                <TextBlock x:Name="txtOverallProgress" Text="Overall: --" Foreground="#E0E0E0" Margin="0,0,0,5"/>
                                <ProgressBar x:Name="pbOverall" Height="20" Minimum="0" Maximum="100" Value="0"
                                             Background="#1A1A1A" Foreground="#00FF7F" BorderBrush="#555555" BorderThickness="1"/>
                            </StackPanel>

                            <StackPanel Grid.Column="2" Margin="15,0,0,0">
                                <TextBlock x:Name="txtEta" Text="ETA: --:--:--" Foreground="#808080"/>
                                <TextBlock x:Name="txtSpeed" Text="Speed: -- MB/s" Foreground="#808080"/>
                                <TextBlock x:Name="txtChunks" Text="Chunks: 0/0" Foreground="#808080"/>
                            </StackPanel>
                        </Grid>

                        <!-- Per-profile error summary (visible only when 2+ profiles running) -->
                        <Border x:Name="pnlProfileErrors" Visibility="Collapsed"
                                Background="#1E1E1E" CornerRadius="4" Padding="10" Margin="0,10,0,0">
                            <StackPanel>
                                <TextBlock Text="Profile Status" Foreground="#808080" FontSize="11" Margin="0,0,0,5"/>
                                <WrapPanel x:Name="pnlProfileErrorItems"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Border>

                <!-- Chunk DataGrid -->
                <DataGrid Grid.Row="1" x:Name="dgChunks" AutoGenerateColumns="False"
                          Style="{StaticResource DarkDataGrid}"
                          CellStyle="{StaticResource DarkDataGridCell}"
                          RowStyle="{StaticResource DarkDataGridRowWithTooltip}"
                          ColumnHeaderStyle="{StaticResource DarkDataGridColumnHeader}"
                          AlternationCount="2"
                          IsReadOnly="True" SelectionMode="Single">
                    <DataGrid.ContextMenu>
                        <ContextMenu x:Name="cmChunks" Style="{StaticResource DarkContextMenu}">
                            <MenuItem x:Name="miRetryChunk" Header="Retry Chunk" Style="{StaticResource DarkMenuItem}"/>
                            <MenuItem x:Name="miSkipChunk" Header="Skip Chunk" Style="{StaticResource DarkMenuItem}"/>
                            <Separator Background="#3E3E3E"/>
                            <MenuItem x:Name="miOpenLog" Header="Open Log File" Style="{StaticResource DarkMenuItem}"/>
                        </ContextMenu>
                    </DataGrid.ContextMenu>
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID" Binding="{Binding ChunkId}" Width="50"/>
                        <DataGridTextColumn Header="Path" Binding="{Binding SourcePath}" Width="*"/>
                        <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100"/>
                        <DataGridTemplateColumn Header="Progress" Width="120">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Grid Height="18">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Border Background="#3E3E3E" CornerRadius="2"/>
                                        <!-- Progress fill bar - green for normal, will be styled blue for Working via code -->
                                        <Border x:Name="progressFill" Background="#4CAF50" CornerRadius="2" HorizontalAlignment="Stretch">
                                            <Border.RenderTransform>
                                                <ScaleTransform ScaleX="{Binding ProgressScale}" ScaleY="1"/>
                                            </Border.RenderTransform>
                                            <Border.RenderTransformOrigin>
                                                <Point X="0" Y="0.5"/>
                                            </Border.RenderTransformOrigin>
                                        </Border>
                                        <TextBlock x:Name="progressText" Text="{Binding Progress, StringFormat={}{0}%}"
                                                   HorizontalAlignment="Center" VerticalAlignment="Center"
                                                   Foreground="White" FontWeight="Bold"/>
                                    </Grid>
                                    <DataTemplate.Triggers>
                                        <!-- Show blue pulsing bar for Working status -->
                                        <DataTrigger Binding="{Binding Status}" Value="Working">
                                            <Setter TargetName="progressFill" Property="Background" Value="#0078D4"/>
                                            <Setter TargetName="progressText" Property="Text" Value="..."/>
                                        </DataTrigger>
                                        <!-- Show scan progress counter during Scanning phase -->
                                        <DataTrigger Binding="{Binding Status}" Value="Scanning">
                                            <Setter TargetName="progressFill" Property="Background" Value="#0078D4"/>
                                            <Setter TargetName="progressText" Property="Text" Value="{Binding Progress}"/>
                                        </DataTrigger>
                                        <!-- Show preparing status during VSS/initialization phase -->
                                        <DataTrigger Binding="{Binding Status}" Value="Preparing">
                                            <Setter TargetName="progressFill" Property="Background" Value="#6B5B95"/>
                                            <Setter TargetName="progressText" Property="Text" Value="..."/>
                                        </DataTrigger>
                                    </DataTemplate.Triggers>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="Speed" Binding="{Binding Speed}" Width="60"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>

            <!-- ==================== LOGS PANEL ==================== -->
            <Grid x:Name="panelLogs" Visibility="Collapsed" Margin="10">
                <Border Background="#252525" CornerRadius="4" Padding="15">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Filter Bar -->
                        <Border Grid.Row="0" Background="#1E1E1E" CornerRadius="4" Padding="10" Margin="0,0,0,10">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Level Filters -->
                                <StackPanel Grid.Column="0" Orientation="Horizontal">
                                    <Label Content="Show:" Style="{StaticResource DarkLabel}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <CheckBox x:Name="chkLogDebug" Content="DEBUG" Style="{StaticResource DarkCheckBox}"
                                              VerticalAlignment="Center" Margin="0,0,15,0" IsChecked="True"/>
                                    <CheckBox x:Name="chkLogInfo" Content="INFO" Style="{StaticResource DarkCheckBox}"
                                              VerticalAlignment="Center" Margin="0,0,15,0" IsChecked="True"/>
                                    <CheckBox x:Name="chkLogWarning" Content="WARNING" Style="{StaticResource DarkCheckBox}"
                                              VerticalAlignment="Center" Margin="0,0,15,0" IsChecked="True"/>
                                    <CheckBox x:Name="chkLogError" Content="ERROR" Style="{StaticResource DarkCheckBox}"
                                              VerticalAlignment="Center" IsChecked="True"/>
                                </StackPanel>

                                <!-- Line Count and Auto-scroll -->
                                <StackPanel Grid.Column="2" Orientation="Horizontal">
                                    <TextBlock x:Name="txtLogLineCount" Text="0 lines" Foreground="#808080"
                                               VerticalAlignment="Center" Margin="0,0,15,0"/>
                                    <CheckBox x:Name="chkLogAutoScroll" Content="Auto-scroll" Style="{StaticResource DarkCheckBox}"
                                              VerticalAlignment="Center" IsChecked="True"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Log Content -->
                        <Border Grid.Row="1" Background="#1E1E1E" BorderBrush="#252525" BorderThickness="1" CornerRadius="4">
                            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
                                <TextBox x:Name="txtLogContent"
                                         Background="#1E1E1E"
                                         Foreground="#E0E0E0"
                                         FontFamily="Consolas"
                                         FontSize="11"
                                         BorderThickness="0"
                                         IsReadOnly="True"
                                         TextWrapping="NoWrap"
                                         VerticalScrollBarVisibility="Auto"
                                         HorizontalScrollBarVisibility="Auto"
                                         AcceptsReturn="True"/>
                            </ScrollViewer>
                        </Border>

                        <!-- Button Bar -->
                        <Border Grid.Row="2" Background="#1E1E1E" CornerRadius="4" Padding="10" Margin="0,10,0,0">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                <Button x:Name="btnLogClear" Content="Clear" Style="{StaticResource DarkButton}"
                                        Width="80" Margin="0,0,5,0"/>
                                <Button x:Name="btnLogCopy" Content="Copy All" Style="{StaticResource DarkButton}"
                                        Width="80" Margin="0,0,5,0"/>
                                <Button x:Name="btnLogSave" Content="Save..." Style="{StaticResource DarkButton}"
                                        Width="80" Margin="0,0,10,0"/>
                                <Button x:Name="btnLogPopOut" Content="Pop Out" Style="{StaticResource LogsButton}"
                                        Width="90" ToolTip="Open log in separate window (Ctrl+L)"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </Border>
            </Grid>

        </Grid>

        <!-- ==================== BOTTOM CONTROL BAR ==================== -->
        <Border Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                Background="#252525" Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Run/Stop/Schedule buttons (left margin aligns with content area past nav rail) -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="50,0,0,0">
                    <Button x:Name="btnRunAll" Content="&#x25B6; Run All"
                            Style="{StaticResource RunButton}" Width="90" Margin="0,0,5,0"
                            ToolTip="Run all enabled profiles"/>
                    <Button x:Name="btnRunSelected" Content="&#x25B6; Run"
                            Style="{StaticResource RunButton}" Width="90" Margin="0,0,5,0"
                            ToolTip="Run selected profile (Ctrl+R)"/>
                    <Button x:Name="btnStop" Content="&#x23F9; Stop"
                            Style="{StaticResource StopButton}" Width="90" Margin="0,0,5,0" IsEnabled="False"
                            ToolTip="Stop replication (Escape)"/>
                </StackPanel>

                <!-- Status text - clickable when errors exist -->
                <TextBlock Grid.Column="1" x:Name="txtStatus" Text="Ready"
                           Foreground="#808080" VerticalAlignment="Center" Margin="15,0"
                           Background="Transparent"/>

                <!-- Workers slider -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Label Content="Workers:" Style="{StaticResource DarkLabel}" ToolTip="Number of parallel workers"/>
                    <Slider x:Name="sldWorkers" Width="80" Minimum="1" Maximum="16" Value="4"
                            Style="{StaticResource DarkSlider}" VerticalAlignment="Center"/>
                    <TextBlock x:Name="txtWorkerCount" Text="4" Foreground="#E0E0E0"
                               Width="20" VerticalAlignment="Center" Margin="5,0,0,0"/>
                </StackPanel>
            </Grid>
        </Border>

    </Grid>
</Window>
